#!/bin/bash

echo "ğŸ” Pre-commit hook ì‹¤í–‰ ì¤‘..."

# í¬ìŠ¤íŠ¸ íŒŒì¼(.md) ë³€ê²½ ê°ì§€
CHANGED_POSTS=$(git diff --cached --name-only | grep "^src/posts/.*\.md$")

if [ -n "$CHANGED_POSTS" ]; then
    echo "ğŸ“ í¬ìŠ¤íŠ¸ íŒŒì¼ ë³€ê²½ ê°ì§€:"
    echo "$CHANGED_POSTS"
    echo ""
    echo "ğŸ”„ ê²€ìƒ‰ ë°ì´í„° ì—…ë°ì´íŠ¸ ì¤‘..."
    
    # Node.jsë¡œ ê²€ìƒ‰ ë°ì´í„° ìƒì„±
    if node src/lib/generate-search-data.js; then
        echo ""
        echo "âœ… ê²€ìƒ‰ ë°ì´í„° ìƒì„± ì™„ë£Œ"
        
        # search-data.jsonì„ staging areaì— ì¶”ê°€
        if [ -f "static/search-data.json" ]; then
            git add static/search-data.json
            echo "ğŸ“‹ search-data.jsonì„ ì»¤ë°‹ì— í¬í•¨"
        fi
    else
        echo ""
        echo "âŒ ê²€ìƒ‰ ë°ì´í„° ìƒì„± ì‹¤íŒ¨"
        exit 1
    fi
else
    echo "â„¹ï¸ í¬ìŠ¤íŠ¸ íŒŒì¼ ë³€ê²½ ì—†ìŒ"
fi

echo "âœ… Pre-commit hook ì™„ë£Œ"
exit 0
